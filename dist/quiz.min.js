window.Quiz=function(){function init(config){const container=document.querySelector(config.container);const questions=config.questions;const total=questions.length;const responses={};const submitUrl=config.submitUrl;const showProgressBar=config.showProgressBar!==undefined?config.showProgressBar:true;const showQuestionCount=config.showQuestionCount!==undefined?config.showQuestionCount:false;const emailRequired=config.emailRequired!==undefined?config.emailRequired:false;const showNameFields=config.showNameFields!==undefined?config.showNameFields:false;const nameFieldsRequired=config.nameFieldsRequired!==undefined?config.nameFieldsRequired:false;const showPhoneField=config.showPhoneField!==undefined?config.showPhoneField:false;const phoneFieldRequired=config.phoneFieldRequired!==undefined?config.phoneFieldRequired:false;const useResponseMessage=config.useResponseMessage!==undefined?config.useResponseMessage:false;let progress,bar;if(showProgressBar){progress=document.createElement("div");progress.className="quiz-progress";const bar=document.createElement("div");bar.className="quiz-progress-bar";bar.style.width="0%";progress.appendChild(bar);container.appendChild(progress)}questions.forEach((q,idx)=>{const card=document.createElement("div");card.className="quiz-card";if(idx===0)card.classList.add("active");card.dataset.index=idx;const questionHeader=document.createElement("div");questionHeader.className="quiz-question-header";const h=document.createElement("h3");h.className="quiz-question";h.textContent=showQuestionCount?q.question:`${idx+1}. ${q.question}`;questionHeader.appendChild(h);if(showQuestionCount){const counter=document.createElement("div");counter.className="quiz-question-counter";counter.textContent=`${idx+1} / ${total}`;questionHeader.appendChild(counter)}card.appendChild(questionHeader);const ul=document.createElement("ul");ul.className="quiz-options";q.options.forEach(opt=>{const li=document.createElement("li");li.className="quiz-option";if(opt.type==="text"||opt.type==="textarea"){const labelWrapper=document.createElement("div");labelWrapper.className="quiz-label-wrapper";const label=document.createElement("label");label.className="quiz-text-label";label.textContent=opt.label;labelWrapper.appendChild(label);li.appendChild(labelWrapper);const inputWrapper=document.createElement("div");inputWrapper.className="quiz-input-wrapper";const inp=opt.type==="textarea"?document.createElement("textarea"):document.createElement("input");if(opt.type==="text")inp.type="text";inp.name=`q${idx}`;inp.className="quiz-input quiz-input-fullwidth";inp.placeholder=opt.placeholder||"";if(opt.required){inp.required=true;label.innerHTML=`${opt.label} <span class="quiz-required">*</span>`}if(opt.rows&&opt.type==="textarea"){inp.rows=opt.rows}inputWrapper.appendChild(inp);li.appendChild(inputWrapper);li.classList.add("quiz-option-text")}else{const label=document.createElement("label");label.className="quiz-option-label";const inp=document.createElement("input");inp.className="quiz-checkbox-radio";inp.type=q.multiple?"checkbox":"radio";inp.name=`q${idx}`;inp.value=opt.value;const span=document.createElement("span");span.className="quiz-option-text";span.textContent=opt.label;label.appendChild(inp);label.appendChild(span);li.appendChild(label)}ul.appendChild(li)});card.appendChild(ul);const btns=document.createElement("div");btns.className="quiz-buttons";const prev=document.createElement("button");prev.textContent="Previous";prev.className="quiz-btn quiz-btn-secondary";prev.disabled=idx===0;prev.addEventListener("click",()=>navigate(-1));const next=document.createElement("button");next.textContent=idx===total-1?"Submit":"Next";next.className="quiz-btn quiz-btn-primary";next.addEventListener("click",()=>navigate(1));btns.appendChild(prev);btns.appendChild(next);card.appendChild(btns);container.appendChild(card)});function showAlert(msg,card){let alertDiv=card.querySelector(".quiz-alert");if(!alertDiv){alertDiv=document.createElement("div");alertDiv.className="quiz-alert";card.querySelector(".quiz-buttons").before(alertDiv)}alertDiv.textContent=msg}function clearAlert(card){const alertDiv=card.querySelector(".quiz-alert");if(alertDiv)alertDiv.remove()}function compileResults(){return questions.map((q,i)=>{const ans=responses[`q${i}`]||[];const hasTextInputs=q.options.some(opt=>opt.type==="text"||opt.type==="textarea");if(hasTextInputs){return`${i+1}. ${q.question}:\n${q.options.map((opt,j)=>{const response=ans[j]||"";return`   ${opt.label}: ${response}`}).join("\n")}`}else{return`${i+1}. ${q.question}: ${ans.join(", ")}`}}).join("\n")}function showSuccessMessage(message){container.innerHTML="";const successContainer=document.createElement("div");successContainer.className="quiz-success-container";const messageContainer=document.createElement("div");messageContainer.className="quiz-success-message";if(typeof message==="string"){if(/<[a-z][\s\S]*>/i.test(message)){messageContainer.innerHTML=message}else{messageContainer.textContent=message}}else if(typeof message==="object"){if(message.html){messageContainer.innerHTML=message.html}else if(message.text){messageContainer.textContent=message.text}}successContainer.appendChild(messageContainer);container.appendChild(successContainer)}function showSubmit(){container.innerHTML="";const div=document.createElement("div");div.className="quiz-submit-container";const title=config.submitTitle||"Enter your email to receive your AI action plan";const titleEl=document.createElement("h3");titleEl.className="quiz-submit-title";titleEl.textContent=title;div.appendChild(titleEl);const inputWrapper=document.createElement("div");inputWrapper.className="quiz-input-wrapper";let firstNameInput,lastNameInput;if(showNameFields){const nameWrapper=document.createElement("div");nameWrapper.className="quiz-input-wrapper quiz-name-fields";const firstNameLabel=document.createElement("label");firstNameLabel.className="quiz-label";firstNameLabel.textContent=nameFieldsRequired?"First name (required)":"First name";firstNameInput=document.createElement("input");firstNameInput.type="text";firstNameInput.className="quiz-input quiz-input-half";firstNameInput.placeholder="Enter your first name";firstNameInput.id="quiz-first-name";firstNameLabel.htmlFor="quiz-first-name";if(nameFieldsRequired){firstNameInput.required=true}const lastNameLabel=document.createElement("label");lastNameLabel.className="quiz-label";lastNameLabel.textContent=nameFieldsRequired?"Last name (required)":"Last name";lastNameInput=document.createElement("input");lastNameInput.type="text";lastNameInput.className="quiz-input quiz-input-half";lastNameInput.placeholder="Enter your last name";lastNameInput.id="quiz-last-name";lastNameLabel.htmlFor="quiz-last-name";if(nameFieldsRequired){lastNameInput.required=true}const firstNameDiv=document.createElement("div");firstNameDiv.className="quiz-field-container";firstNameDiv.appendChild(firstNameLabel);firstNameDiv.appendChild(firstNameInput);const lastNameDiv=document.createElement("div");lastNameDiv.className="quiz-field-container";lastNameDiv.appendChild(lastNameLabel);lastNameDiv.appendChild(lastNameInput);nameWrapper.appendChild(firstNameDiv);nameWrapper.appendChild(lastNameDiv);div.appendChild(nameWrapper)}const emailWrapper=document.createElement("div");emailWrapper.className="quiz-input-wrapper";const emailLabel=document.createElement("label");emailLabel.className="quiz-label";emailLabel.textContent=emailRequired?"Email address (required)":"Email address";emailLabel.htmlFor="quiz-email";const emailInput=document.createElement("input");emailInput.type="email";emailInput.className="quiz-input quiz-input-fullwidth";emailInput.placeholder="Enter your email address";emailInput.id="quiz-email";if(emailRequired){emailInput.required=true}const emailFieldContainer=document.createElement("div");emailFieldContainer.className="quiz-field-container";emailFieldContainer.appendChild(emailLabel);emailFieldContainer.appendChild(emailInput);emailWrapper.appendChild(emailFieldContainer);div.appendChild(emailWrapper);let phoneInput;if(showPhoneField){const phoneWrapper=document.createElement("div");phoneWrapper.className="quiz-input-wrapper";const phoneLabel=document.createElement("label");phoneLabel.className="quiz-label";phoneLabel.textContent=phoneFieldRequired?"Phone number (required)":"Phone number";phoneLabel.htmlFor="quiz-phone";phoneInput=document.createElement("input");phoneInput.type="tel";phoneInput.className="quiz-input quiz-input-fullwidth";phoneInput.placeholder="Phone number";phoneInput.id="quiz-phone";if(phoneFieldRequired){phoneInput.required=true;phoneInput.placeholder="Phone number (required)"}const phoneFieldContainer=document.createElement("div");phoneFieldContainer.className="quiz-field-container";phoneFieldContainer.appendChild(phoneLabel);phoneFieldContainer.appendChild(phoneInput);phoneWrapper.appendChild(phoneFieldContainer);div.appendChild(phoneWrapper)}const alertEl=document.createElement("div");alertEl.className="quiz-alert";div.appendChild(alertEl);const btnWrapper=document.createElement("div");btnWrapper.className="quiz-btn-wrapper";const btn=document.createElement("button");btn.className="quiz-btn quiz-btn-primary quiz-mt-3";const btnTextSpan=document.createElement("span");btnTextSpan.textContent=config.submitButtonText||"Send me the plan";btn.appendChild(btnTextSpan);const loadingIndicator=document.createElement("span");loadingIndicator.className="quiz-loading";btn.appendChild(loadingIndicator);btnWrapper.appendChild(btn);div.appendChild(btnWrapper);btn.addEventListener("click",()=>{alertEl.textContent="";const email=emailInput.value.trim();let isValid=true;if(showNameFields&&nameFieldsRequired){const firstName=firstNameInput.value.trim();const lastName=lastNameInput.value.trim();if(!firstName){firstNameInput.classList.add("quiz-input-error");isValid=false}else{firstNameInput.classList.remove("quiz-input-error")}if(!lastName){lastNameInput.classList.add("quiz-input-error");isValid=false}else{lastNameInput.classList.remove("quiz-input-error")}if(!isValid){alertEl.textContent="Please enter your full name.";return}}if(emailRequired&&!email){emailInput.classList.add("quiz-input-error");alertEl.textContent="Please enter your email address.";return}else if(email&&!/^\S+@\S+\.\S+$/.test(email)){emailInput.classList.add("quiz-input-error");alertEl.textContent="Please enter a valid email address.";return}else{emailInput.classList.remove("quiz-input-error")}if(showPhoneField&&phoneFieldRequired){const phone=phoneInput.value.trim();if(!phone){phoneInput.classList.add("quiz-input-error");alertEl.textContent="Please enter your phone number.";return}else{phoneInput.classList.remove("quiz-input-error")}}btn.disabled=true;btn.classList.add("submitting");btnTextSpan.textContent="Submitting...";const submissionData={email:email,results:compileResults()};if(showNameFields){submissionData.first_name=firstNameInput.value.trim();submissionData.last_name=lastNameInput.value.trim()}if(showPhoneField){submissionData.phone=phoneInput.value.trim()}fetch(submitUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(submissionData)}).then(res=>{btn.classList.remove("submitting");if(res.ok){if(config.onComplete){container.innerHTML=config.onComplete(responses)}else if(useResponseMessage){res.text().then(text=>{showSuccessMessage(text||config.successMessage||"Thank you! Your submission has been received.")}).catch(()=>{showSuccessMessage(config.successMessage||"Thank you! Your submission has been received.")})}else if(config.successMessage){showSuccessMessage(config.successMessage)}else{showSuccessMessage("Thank you! Your submission has been received.")}}else{alertEl.textContent="Submission failed. Try again.";btn.disabled=false;btnTextSpan.textContent=config.submitButtonText||"Send me the plan"}}).catch(()=>{alertEl.textContent="Submission error.";btn.disabled=false;btn.classList.remove("submitting");btnTextSpan.textContent=config.submitButtonText||"Send me the plan"})});container.appendChild(div)}function navigate(step){const cards=container.querySelectorAll(".quiz-card");const active=container.querySelector(".quiz-card.active");const idx=parseInt(active.dataset.index,10);if(step>0){const question=questions[idx];const hasTextInputs=question.options.some(opt=>opt.type==="text"||opt.type==="textarea");if(hasTextInputs){const textInputs=active.querySelectorAll('input[type="text"], textarea');const values=Array.from(textInputs).map(input=>input.value.trim());const emptyRequired=Array.from(textInputs).some(input=>input.required&&input.value.trim()==="");if(emptyRequired){Array.from(textInputs).forEach(input=>{if(input.required&&input.value.trim()===""){input.classList.add("quiz-input-error")}else{input.classList.remove("quiz-input-error")}})}if(emptyRequired){showAlert("Please fill in all required fields.",active);return}clearAlert(active);responses[`q${idx}`]=values}else{const inputs=active.querySelectorAll("input");const checked=Array.from(inputs).filter(i=>i.checked);if(checked.length===0){showAlert("Please select an option.",active);return}clearAlert(active);responses[`q${idx}`]=checked.map(i=>i.value)}}else{clearAlert(active)}active.classList.remove("active");const nextIdx=idx+step;if(nextIdx<questions.length){container.querySelector(`.quiz-card[data-index="${nextIdx}"]`).classList.add("active");if(showProgressBar){progress.querySelector(".quiz-progress-bar").style.width=`${nextIdx/total*100}%`}}else{if(showProgressBar){progress.querySelector(".quiz-progress-bar").style.width="100%"}showSubmit()}}}return{init:init}}();